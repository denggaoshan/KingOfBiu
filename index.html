<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
</head>

<link rel="stylesheet" type="text/css" href="style.css" >
    
<body>

<header id="id-header">第 1 关, 第 1 回合</header>

<div id="id-roles">
    <!--头像-->
    <div id="id-roleimg-player" class="two-left"></div>
    <div id="id-roleimg-enemy" class="two-right"></div>
    
    <!--属性-->
    <div id="id-roleinfo-player" class="two-left">
    <h3>玩家1 </h3>
    剩余血量：<div id="id-player-life">5</div>
    当前能量：<div id="id-player-energy">0</div>
    </div>

    <div id="id-roleinfo-enemy" class="two-left">
    <h3>敌人 </h3>
    剩余血量：<div id="id-enemy-life">5</div>
    当前能量：<div id="id-enemy-energy">0</div>
    </div>

</div>

    
<!--操作栏-->
<div>
    <h1>本回合的操作</h1>
    
    <div>
        <button type="button" onclick="accumulate()">蓄力</button>
        <button type="button" onclick="attack1()">普攻</button>
        <button type="button" onclick="defend1()">防御</button>
        <button type="button" onclick="attack3()">大招</button>
        <button type="button">重新开始</button>
    </div>

    <label id="id-operation-info"></label>

</div>

<!--战斗记录栏-->
<div>
    <h1>战斗记录</h1>
    
    <div id="id-battle-result">
    </div>

</div>

</body>

<script>

var log = console.log.bind(console)

var Player = function(){
    var o = {
        name: "玩家1",
        life: 5,
        energy: 0,
        attack: 1,
    }

    //AI自动行动
    o.autoPlay = function(){
        if (o.energy == 0){
            return 1
        }
        else{
            return 2
        }
    }
    
    return o
}

var KoGame = function(){
    
    var o = {
        level: 1,
        turn: 1,

        player: 1, //玩家
        enemy: 1,  //敌方
    }

    o.update = function(){
        //更新关卡，回合
        //更新角色图片
        //更新双方信息
    }

    //游戏初始化
    o.init = function(){
        player = new Player()
        enemy = new Player()
        o.player = player
        o.enemy = enemy
    }

    o.getPlayer = function(){
        return o.player
    }

    o.getEnemy = function(){
        return o.enemy
    }

    //执行回合结束操作
    //Action: 1蓄力 2普攻 3防御 4破防 5大招 6重开
    o.endTurn = function(playerAction){

        var player = game.getPlayer()
        var enemy = game.getEnemy()

        //敌方行动
        var enemyAction = enemy.autoPlay()
        log("敌方"+enemyAction)

        //```````````战斗判定```````````

        document.getElementById('id-battle-result').innerHTML += "("+game.turn+")"

        if(playerAction == 1 && enemyAction == 1){
            //同时积攒能量
            player.energy += 1
            enemy.energy += 1
            document.getElementById('id-battle-result').innerHTML += "双方蓄力"
        }

        if(playerAction == 1 && enemyAction == 2){
            //我方被打
            player.life -= 1
            enemy.energy -= 1
            document.getElementById('id-battle-result').innerHTML += "遭到敌方攻击，蓄力被打断"
        }

        if(playerAction == 1 && enemyAction == 3){
            //敌方防御
            player.energy += 1
            document.getElementById('id-battle-result').innerHTML += "敌方防御"
        }

        if(playerAction == 2 && enemyAction == 1){
            //敌方被打
            enemy.life -= 1
            player.energy -= 1
            document.getElementById('id-battle-result').innerHTML += "成功打断敌方蓄力"
        }

        if(playerAction == 2 && enemyAction == 2){
            //双方同时出手
            enemy.energy -= 1
            player.energy -= 1
            document.getElementById('id-battle-result').innerHTML += "同时出手，攻击抵消"
        }

        if(playerAction == 2 && enemyAction == 3){
            //我方攻击，敌方防御
            player.energy -= 1
            document.getElementById('id-battle-result').innerHTML += "攻击被敌方防御"            
        }        

        if(playerAction == 3 && enemyAction == 1){
            //我方防御，敌方蓄力
            enemy.energy += 1
            document.getElementById('id-battle-result').innerHTML += "敌方蓄力"            
        }

        if(playerAction == 3 && enemyAction == 2){
            //我方防御，敌方攻击
            enemy.energy -= 1
            document.getElementById('id-battle-result').innerHTML += "防御敌方攻击"            
        }

        if(playerAction == 3 && enemyAction == 3){
            //双方都防御
            document.getElementById('id-battle-result').innerHTML += "双方同时防御"            
        }



        //更新游戏数据
        o.turn += 1

        //刷新视图
        o.update()
    }


    o.update = function(){
        var player = game.getPlayer()
        var enemy = game.getEnemy()

        //检测游戏是否结束
        if (player.life <= 0){
            document.getElementById('id-header').innerHTML = "失败"
            return
        }

        if (enemy.life <= 0){
            document.getElementById('id-header').innerHTML = "胜利！"
            return
        }

        //抬头
        document.getElementById('id-header').innerHTML = "第 "+game.level+" 关, 第 "+game.turn+" 回合"
        //图片 TODO

        //玩家信息
        document.getElementById('id-player-life').innerHTML = player.life
        document.getElementById('id-player-energy').innerHTML = player.energy

        //敌方信息
        document.getElementById('id-enemy-life').innerHTML = enemy.life
        document.getElementById('id-enemy-energy').innerHTML = enemy.energy
    }

    return o
}

var game = new KoGame()


//蓄力
function accumulate(){
    game.endTurn(1)
}

//普攻
function attack1(){
    //检测是否是合法的
    var player = game.getPlayer()
    if(player.energy > 0){
        game.endTurn(2)    
    }else{
        document.getElementById('id-operation-info').innerHTML = "无法出手, 能量不足"
    }
}

//防御
function defend1(){
    game.endTurn(3)
}

//入口
function __main(){
    game.init()
}

__main()
</script>
</html>